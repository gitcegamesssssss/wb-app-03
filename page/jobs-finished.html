<!doctype html>
<html lang="en">

<head>
    <title>Finished Jobs</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="../assets/bootstrap/css/bootstrap.min.css" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>   
    <script src="/wb-app-03/js/main.js"></script>
    <link href="../assets/icon/open-iconic/font/css/open-iconic-bootstrap.css" rel="stylesheet">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
</head>

<body style="display:none">
    <div id="navbar-main">
    </div>
    <div class="container-fluid">
        <div class="container-fluid mt-3">
            <div class="row">
                <div class="col-md-6 float-left">
                    <span class="mx-md-3 font-weight-bold">
                        <span class="oi oi-calendar"></span>
                        <span>Date : </span>
                        <span id="current-date" class="text-primary"></span>
                    </span>
                </div>
            </div>
            <!-- #table controller -->
            <div id="table-controller" class="float-right">                    
                <div class="form-group">                  
                  <select class="form-control" id="table-size-controller" name="table-size-controller" size=1 onchange="sizeChange(this.value)">
                    <option value="1"selected>1</option>
                    <option value="10">10</option>
                    <option value="50">50</option>                
                    <option value="100">100</option>                    
                  </select>
                </div>       
            </div>
            <!-- #table -->
            <div class="mt-3">
                <table class="table table-striped table-bordered text-center" id="main-table">
                    <thead>
                        <!-- 9-cols -->
                        <tr>
                            <th style="width: 5%">Order</th>
                            <th style="width: 10%">Item Name</th>
                            <th style="width: 30%">Item Details</th>
                            <th style="width: 10%">Customer Name</th>
                            <th style="width: 5%">Cost/Unit</th>
                            <th style="width: 5%">Unit</th>
                            <th style="width: 5%">total</th>
                            <th style="width: 10%">Agent Name</th>
                            <th >Date/Time</th>
                        </tr>
                    </thead>
                    <tbody id="main-table-body">                        
                    </tbody>
                </table>
            </div>

        </div>        
    </div>
    <script>
        checkToken(sessionStorage.wbUsr, sessionStorage.wbToken);
        $('#navbar-main').load("../components/navbar-main/navbar-main.html #navbar-main");
        $.getScript("../components/navbar-main/navbar-main.js");

        //-------------------------
        var rawData = ""; //json-string
        var cookedData = "";//json-obj
        var size = document.getElementById("table-size-controller").value;

        var strDate = "";
        //-------------------------
        $(document).ready(function () {
                t_days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thur', 'Fri', 'Sat'];
                t_n = new Date();
                t_y = t_n.getFullYear();
                t_m = t_n.getMonth() + 1;
                t_d = t_n.getDate();
                t_ds = t_n.getDay();
                document.getElementById("current-date").innerHTML = t_days[t_ds] + " " + t_m + "/" + t_d + "/" + t_y;
                //generate table
                //-prepare string for request service
                strDate = `${String(t_n.getFullYear())}-${String("0" + (t_n.getMonth() + 1)).slice(-2)}-${String("0" + t_n.getDate()).slice(-2)}`;
                //-requesting raw data
                $.ajax({
                    url: `/wb-app-03/ajax/service/finService/requestFinRecord.php?date=${strDate}`,
                    type: 'GET',
                    success: function (result) {
                        if (result != "0") {
                            rawData = result;  
                            //init cooked data
                            cookedData = rawData;
                            cookedData = JSON.parse(cookedData);
                            sizeCooking(size);                 
                            generateTable();                                                                                                                      
                        }
                    }
                });
            });       



        //============= function-zone ====================
        //============= function-zone ====================
        //============= function-zone ====================
        //============= function-zone ====================        
        function generateTable() {            
            var tmpTable = document.getElementById("main-table-body");
            tmpTable.innerHTML = "";
            cookedData.forEach(el => {     
                console.log(el);           
                var i = 0;
                var tmpRow = tmpTable.insertRow(i);
                var cell_1 = tmpRow.insertCell(0);
                var cell_2 = tmpRow.insertCell(1);
                var cell_3 = tmpRow.insertCell(2);                
                var cell_4 = tmpRow.insertCell(3);
                var cell_5 = tmpRow.insertCell(4);
                var cell_6 = tmpRow.insertCell(5);                
                var cell_7 = tmpRow.insertCell(6);
                var cell_8 = tmpRow.insertCell(7);
                var cell_9 = tmpRow.insertCell(8); 
                cell_1.innerHTML = el.orderId;
                cell_2.innerHTML = el.itemName;
                cell_3.innerHTML = el.itemDetails;
                cell_4.innerHTML = el.customerName;
                cell_5.innerHTML = el.cost;
                cell_6.innerHTML = el.unit;
                cell_7.innerHTML = el.cost * el.unit;
                cell_8.innerHTML = el.agentName;
                cell_9.innerHTML = el.addDate; 
                i++;
            });
        }
        function sizeCooking(size) {
            cookedData = rawData;
            cookedData = JSON.parse(cookedData);
            cookedData.reverse();
            //sizing cookedData from rawData            
            let popAmount = cookedData.length - size;
            for (let index = 0; index < popAmount; index++) {
                cookedData.pop();  
            }
            cookedData.reverse();
        }
        function sizeChange(newsize){
            size = newsize;
            sizeCooking(size);
            generateTable();            
        }
    </script>
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="../assets/bootstrap/js/bootstrap.js" crossorigin="anonymous"></script>
</body>

</html>